<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <title>Conventions</title>
  <meta name="description" content="The Unified Font Object (UFO) is a cross-platform, cross-application, human readable, future proof format for storing font data.
">

  <link rel="stylesheet" href="/media/main.css">
  <link rel="canonical" href="http://unifiedfontobject.org/versions/ufo3/conventions/">
</head>

  <body>
    <header class="site-header">
    <div id="logo"></div>
    <div id="navigation">
        <ul>
            
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
                    
                    <li><a  href="/">Overview</a></li>
                    
                
            
                
                    
                    <li><a  href="/team/">The UFO Team</a></li>
                    
                
            
                
                    
                    <li><a  href="/resources/">Resources</a></li>
                    
                
            
                
                    
                    <li><a  href="/roadmap/">Roadmap</a></li>
                    
                
            
                
                    
                    <li><a  href="/atguidelines/">Authoring Tool Guidelines</a></li>
                    
                
            
                
                    
                        <li class="navigationSectionTitle">Versions</li>
                    
                    <li><a  href="/versions/ufo1/">UFO 1</a></li>
                    
                        <ul class="navigationNested ">
                            
                                <li><a href="/versions/ufo1/metainfo.plist">metainfo.plist</a></li>
                            
                                <li><a href="/versions/ufo1/fontinfo.plist">fontinfo.plist</a></li>
                            
                                <li><a href="/versions/ufo1/groups.plist">groups.plist</a></li>
                            
                                <li><a href="/versions/ufo1/kerning.plist">kerning.plist</a></li>
                            
                                <li><a href="/versions/ufo1/lib.plist">lib.plist</a></li>
                            
                                <li><a href="/versions/ufo1/glyphs">glyphs</a></li>
                            
                                <li class="navigationNested1"><a href="/versions/ufo1/glyphs/contents.plist">contents.plist</a></li>
                            
                                <li class="navigationNested1"><a href="/versions/ufo1/glyphs/glif">glif</a></li>
                            
                        </ul>
                    
                
            
                
                    
                    <li><a  href="/versions/ufo2/">UFO 2</a></li>
                    
                        <ul class="navigationNested ">
                            
                                <li><a href="/versions/ufo2/metainfo.plist">metainfo.plist</a></li>
                            
                                <li><a href="/versions/ufo2/fontinfo.plist">fontinfo.plist</a></li>
                            
                                <li><a href="/versions/ufo2/groups.plist">groups.plist</a></li>
                            
                                <li><a href="/versions/ufo2/kerning.plist">kerning.plist</a></li>
                            
                                <li><a href="/versions/ufo2/features.fea">features.fea</a></li>
                            
                                <li><a href="/versions/ufo2/lib.plist">lib.plist</a></li>
                            
                                <li><a href="/versions/ufo2/glyphs">glyphs</a></li>
                            
                                <li class="navigationNested1"><a href="/versions/ufo2/glyphs/contents.plist">contents.plist</a></li>
                            
                                <li class="navigationNested1"><a href="/versions/ufo2/glyphs/GLIF">GLIF</a></li>
                            
                        </ul>
                    
                
            
                
                    
                    <li><a  href="/versions/ufo3/">UFO 3</a></li>
                    
                        <ul class="navigationNested  active">
                            
                                <li><a href="/versions/ufo3/metainfo.plist">metainfo.plist</a></li>
                            
                                <li><a href="/versions/ufo3/fontinfo.plist">fontinfo.plist</a></li>
                            
                                <li><a href="/versions/ufo3/groups.plist">groups.plist</a></li>
                            
                                <li><a href="/versions/ufo3/kerning.plist">kerning.plist</a></li>
                            
                                <li><a href="/versions/ufo3/features.fea">features.fea</a></li>
                            
                                <li><a href="/versions/ufo3/lib.plist">lib.plist</a></li>
                            
                                <li><a href="/versions/ufo3/layercontents.plist">layercontents.plist</a></li>
                            
                                <li><a href="/versions/ufo3/glyphs">glyphs</a></li>
                            
                                <li class="navigationNested1"><a href="/versions/ufo3/glyphs/contents.plist">contents.plist</a></li>
                            
                                <li class="navigationNested1"><a href="/versions/ufo3/glyphs/layerinfo.plist">layerinfo.plist</a></li>
                            
                                <li class="navigationNested1"><a href="/versions/ufo3/glyphs/GLIF">GLIF</a></li>
                            
                                <li><a href="/versions/ufo3/images">images</a></li>
                            
                                <li><a href="/versions/ufo3/data">data</a></li>
                            
                                <li><a href="/versions/ufo3/conventions">conventions</a></li>
                            
                        </ul>
                    
                
            
        </ul>
    </div>
</header>

    <div id="content">
      <div class="section">
        
          <h1>Conventions</h1>
        
        <p>These are conventions that are used throughout the UFO.</p>

<h3 id="xml-property-lists">XML Property Lists</h3>

<p>XML property lists are used throughout this specification. <a href="http://www.apple.com/DTDs/PropertyList-1.0.dtd">A DTD is available.</a></p>

<p>It is recommended, but not required, that dictionaries in property lists be written in ascending order based on the keys of the dictionary. This makes UFO usage more convenient in revision control systems, among other things.</p>

<h3 id="coordinate-system">Coordinate System</h3>

<p>Coordinates and transformations in the UFO are relative to the origin (x=0 and y=0), the positive x-axis points towards the right and the positive y-axis points up, unless otherwise noted.</p>

<h3 id="data-types">Data Types</h3>

<p>These types are used throughout the UFO specification.</p>

<p>While efforts have been made to define how many of the values in various UFO files relate to binary files such as OpenType, it is the responsibility of authoring tools to ensure the UFO values convert to said binary values appropriately. For example, in OpenType many fields require unsigned short integers, but a UFO may contain values for these fields that are greater than 65,535.</p>

<h4 id="string">string</h4>

<p>A string is specified with one or more characters encoded with the encoding scheme defined for the XML file that the string belongs to. The range of characters allowed in a given string field in the UFO may be limited. In these cases the specification defines the available subset.</p>

<h4 id="integer">integer</h4>

<p>An integer is specified with an optional sign character (“+” or “-“) followed by one or more digits “0” to “9”. There is not limit to the number of integer digits. If a sign character is not present, the number is non-negative.</p>

<h4 id="non-negative-integer">non-negative integer</h4>

<p>An integer greater than or equal to zero. See above for integer notation.</p>

<h4 id="float">float</h4>

<p>A float is specified with an optional sign character (“+” or “-“) followed by zero or more digits “0” to “9” followed by a period “.” followed by one or more digits “0” to “9”. There is no limit to the number of digits before or after the decimal. If a sign character is not present, the number is non-negative.</p>

<p>Authoring tools should not write floats that can be represented losslessly as integers unless the specification requires a float.</p>

<h4 id="non-negative-float">non-negative float</h4>

<p>A float greater than or equal to zero. See above for float notation.</p>

<h4 id="list">list</h4>

<p>An collection of items. The items are ordered, however the order is insignificant unless otherwise stated for a particular list in this specification.</p>

<h4 id="dictionary">dictionary</h4>

<p>A dictionary is an unordered associative array mapping keys to values. In the XML property lists used throughout the UFO, the keys must be strings. Values may be any type, though the options are defined throughout this specification.</p>

<h4 id="color-definition">color definition</h4>

<p>A color definition is defined as a string containing a comma-separated sequence of four integers or floats between 0 and 1. White space characters are allowed around the numerical values. The values in the string define the red, green, blue and alpha components of the color. The color is always specified in the <a href="http://en.wikipedia.org/wiki/SRGB">sRGB</a> color space.</p>

<p>Examples</p>

<table>
  <thead>
    <tr>
      <th>string</th>
      <th>red component</th>
      <th>green component</th>
      <th>blue component</th>
      <th>alpha component</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1,0,0,1</td>
      <td>1.0</td>
      <td>0</td>
      <td>0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <td>0,.5,0,.5</td>
      <td>0</td>
      <td>0.5</td>
      <td>0</td>
      <td>0.5</td>
    </tr>
  </tbody>
</table>

<h3 id="reverse-domain-naming-schemes">Reverse Domain Naming Schemes</h3>

<p>In several places in the UFO the <a href="http://en.wikipedia.org/wiki/Reverse-DNS">reverse domain naming system</a> is recommended for creating unique keys and ids. To make a reverse domain, reverse the relevant Internet domain. For example, if the Internet domain is <em>unifiedfontobject.org</em>, the reverse domain name would be <em>org.unifiedfontobject</em>. Further extensions to make the string unique may be added. For example, <em>org.unifiedfontobject.MySpecialTool</em>.</p>

<p>The name <em>public.*</em>, where * represents an arbitrary string of one or more characters, is reserved for use by data structures that are part of the UFO specification.</p>

<h3 id="common-user-name-to-file-name-algorithm">Common User Name to File Name Algorithm</h3>

<p>There is no standard user name to file name conversion. The algorithm below is an example of a common conversion process. It has been designed to avoid name clashes and work with common file systems. It applies the following rules:</p>

<ol>
  <li>Filenames must be unique.</li>
  <li>Filenames must be case insensitive.</li>
  <li>
    <table>
      <tbody>
        <tr>
          <td>Filenames may use any character that can be represented by UTF-8 except: “ (0x22) ( (0x28) ) (0x29) * (0x2A) + (0x2B) / (0x2F) : (0x3A) &lt; (0x3C) &gt; (0x3E) ? (0x3F) [ (0x5B) \ (0x5C) ] (0x5D)</td>
          <td>(0x7C) and anything in the ASCII control character range (0x00-0x1F and 0x7F).</td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>Filenames must be no longer than 255 characters.</li>
  <li>Filenames, regardless of extension and case, must not match any of the <a href="http://support.microsoft.com/kb/74496/en-us">MS-DOS reserved file names</a>.</li>
</ol>

<ul>
  <li><em>name</em> is the user name without any required prefix or suffix.</li>
  <li><em>maximum length</em> is 255 minus the length of a prefix and/or suffix that will be added to the name.</li>
  <li>Perform a generic translation of the name without consideration for existing names:</li>
  <li>
    <ul>
      <li>
        <table>
          <tbody>
            <tr>
              <td>Replace any illegal characters in <em>name</em> with underscores, where the illegal characters are: “ * + / : &lt; &gt; ? [ \ ]</td>
              <td>anything in the range 0x00-0x1F and 0x7F.</td>
            </tr>
          </tbody>
        </table>
      </li>
      <li>Insert an underscore immediately after any uppercase character.</li>
      <li>If the name begins with a period and a prefix will not be added to the name, replace the period with an underscore.</li>
      <li>If the revised <em>name</em> is longer than <em>maximum length</em>:</li>
      <li>
        <ul>
          <li>Remove as many characters from the end of <em>name</em> as needed to make <em>name</em> no longer than <em>maximum length</em>.</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>Use period as a delimiter to split <em>name</em> into parts. For every one of these parts:</li>
  <li>
    <ul>
      <li>If a case-insensitive version of <em>part</em> is in the list of MS-DOS reserved filenames, where the illegal filenames are: CON, PRN, AUX, CLOCK$, NUL, A:-Z:, COM1, LPT1, LPT2, LPT3, COM2, COM3 and COM4:</li>
      <li>
        <ul>
          <li>Insert an underscore at the beginning of the part.</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>Rejoin all of the parts with periods as needed.</li>
  <li>
    <ul>
      <li>Insert an underscore before the start of the illegal filename.</li>
    </ul>
  </li>
  <li>If a case-insensitive version of <em>name</em> is unique:</li>
  <li>
    <ul>
      <li>Stop.</li>
    </ul>
  </li>
  <li>If a case-insensitive version of <em>name</em> is not unique:</li>
  <li>
    <ul>
      <li>Remove as many characters from the end of <em>name</em> as needed to make <em>name</em> no longer than <em>maximum length</em> minus 15.</li>
      <li>Starting with 000000000000001, add 15 zero filled characters to the name.</li>
      <li>If a case-insensitive version of <em>name</em> is unique:</li>
      <li>
        <ul>
          <li>Stop.</li>
        </ul>
      </li>
      <li>Otherwise increment the number by 1 and repeat until a case-insensitive unique name is found or 999999999999999 is reached.</li>
    </ul>
  </li>
  <li>If a case-insensitive version of <em>name</em> is not unique:</li>
  <li>
    <ul>
      <li><em>number</em> is 1.</li>
      <li><em>name</em> is <em>number</em>.</li>
      <li>If <em>name</em> is unique:</li>
      <li>
        <ul>
          <li>Stop.</li>
        </ul>
      </li>
      <li>Otherwise increment number by 1 and repeat until a unique name is found or all possible numbers in a string <em>maximum length</em> long has been reached.</li>
    </ul>
  </li>
  <li>If <em>name</em> is not unique:</li>
  <li>
    <ul>
      <li>Raise an error and let the user know that after trying more than 10<sup>255</sup> names, nothing unique could be found.</li>
    </ul>
  </li>
</ul>

<h4 id="examples">Examples</h4>

<table>
  <thead>
    <tr>
      <th>glyph name</th>
      <th>file name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>a</td>
      <td>a</td>
    </tr>
    <tr>
      <td>A</td>
      <td>A_</td>
    </tr>
    <tr>
      <td>AE</td>
      <td>A_E_</td>
    </tr>
    <tr>
      <td>Ae</td>
      <td>A_e</td>
    </tr>
    <tr>
      <td>ae</td>
      <td>ae</td>
    </tr>
    <tr>
      <td>aE</td>
      <td>aE_</td>
    </tr>
    <tr>
      <td>a.alt</td>
      <td>a.alt</td>
    </tr>
    <tr>
      <td>A.alt</td>
      <td>A_.alt</td>
    </tr>
    <tr>
      <td>A.Alt</td>
      <td>A_.A_lt</td>
    </tr>
    <tr>
      <td>A.aLt</td>
      <td>A_.aL_t</td>
    </tr>
    <tr>
      <td>A.alT</td>
      <td>A_.alT_</td>
    </tr>
    <tr>
      <td>T_H</td>
      <td>T__H_</td>
    </tr>
    <tr>
      <td>T_h</td>
      <td>T__h</td>
    </tr>
    <tr>
      <td>t_h</td>
      <td>t_h</td>
    </tr>
    <tr>
      <td>F_F_I</td>
      <td>F__F__I_</td>
    </tr>
    <tr>
      <td>f_f_i</td>
      <td>f_f_i</td>
    </tr>
    <tr>
      <td>Aacute_V.swash</td>
      <td>A_acute_V_.swash</td>
    </tr>
    <tr>
      <td>.notdef</td>
      <td>_notdef</td>
    </tr>
    <tr>
      <td>con</td>
      <td>_con</td>
    </tr>
    <tr>
      <td>CON</td>
      <td>C_O_N_</td>
    </tr>
    <tr>
      <td>con.alt</td>
      <td>_con.alt</td>
    </tr>
    <tr>
      <td>alt.con</td>
      <td>alt._con</td>
    </tr>
  </tbody>
</table>

<h4 id="example-implementation">Example implementation:</h4>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">illegalCharacters</span> <span class="o">=</span> <span class="s">"</span><span class="se">\"</span><span class="s"> * + / : &lt; &gt; ? [ </span><span class="err">\</span><span class="s"> ] | </span><span class="se">\0</span><span class="s">"</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">" "</span><span class="p">)</span>
<span class="n">illegalCharacters</span> <span class="o">+=</span> <span class="p">[</span><span class="nb">chr</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">32</span><span class="p">)]</span>
<span class="n">illegalCharacters</span> <span class="o">+=</span> <span class="p">[</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x7F</span><span class="p">)]</span>
<span class="n">reservedFileNames</span> <span class="o">=</span> <span class="s">"CON PRN AUX CLOCK$ NUL A:-Z: COM1"</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">" "</span><span class="p">)</span>
<span class="n">reservedFileNames</span> <span class="o">+=</span> <span class="s">"LPT1 LPT2 LPT3 COM2 COM3 COM4"</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">" "</span><span class="p">)</span>
<span class="n">maxFileNameLength</span> <span class="o">=</span> <span class="mi">255</span>

<span class="k">def</span> <span class="nf">userNameToFileName</span><span class="p">(</span><span class="n">userName</span><span class="p">,</span> <span class="n">existing</span><span class="o">=</span><span class="p">[],</span> <span class="n">prefix</span><span class="o">=</span><span class="s">""</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s">""</span><span class="p">):</span>
    <span class="s">"""
    existing should be a case-insensitive list
    of all existing file names.

    &gt;&gt;&gt; userNameToFileName(u"a")
    u'a'
    &gt;&gt;&gt; userNameToFileName(u"A")
    u'A_'
    &gt;&gt;&gt; userNameToFileName(u"AE")
    u'A_E_'
    &gt;&gt;&gt; userNameToFileName(u"Ae")
    u'A_e'
    &gt;&gt;&gt; userNameToFileName(u"ae")
    u'ae'
    &gt;&gt;&gt; userNameToFileName(u"aE")
    u'aE_'
    &gt;&gt;&gt; userNameToFileName(u"a.alt")
    u'a.alt'
    &gt;&gt;&gt; userNameToFileName(u"A.alt")
    u'A_.alt'
    &gt;&gt;&gt; userNameToFileName(u"A.Alt")
    u'A_.A_lt'
    &gt;&gt;&gt; userNameToFileName(u"A.aLt")
    u'A_.aL_t'
    &gt;&gt;&gt; userNameToFileName(u"A.alT")
    u'A_.alT_'
    &gt;&gt;&gt; userNameToFileName(u"T_H")
    u'T__H_'
    &gt;&gt;&gt; userNameToFileName(u"T_h")
    u'T__h'
    &gt;&gt;&gt; userNameToFileName(u"t_h")
    u't_h'
    &gt;&gt;&gt; userNameToFileName(u"F_F_I")
    u'F__F__I_'
    &gt;&gt;&gt; userNameToFileName(u"f_f_i")
    u'f_f_i'
    &gt;&gt;&gt; userNameToFileName(u"Aacute_V.swash")
    u'A_acute_V_.swash'
    &gt;&gt;&gt; userNameToFileName(u".notdef")
    u'_notdef'
    &gt;&gt;&gt; userNameToFileName(u"con")
    u'_con'
    &gt;&gt;&gt; userNameToFileName(u"CON")
    u'C_O_N_'
    &gt;&gt;&gt; userNameToFileName(u"con.alt")
    u'_con.alt'
    &gt;&gt;&gt; userNameToFileName(u"alt.con")
    u'alt._con'
    """</span>
    <span class="c"># the incoming name must be a unicode string</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">userName</span><span class="p">,</span> <span class="nb">unicode</span><span class="p">),</span>
        <span class="s">"The value for userName must be a unicode string."</span>
    <span class="c"># establish the prefix and suffix lengths</span>
    <span class="n">prefixLength</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span>
    <span class="n">suffixLength</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">suffix</span><span class="p">)</span>
    <span class="c"># replace an initial period with an _</span>
    <span class="c"># if no prefix is to be added</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">prefix</span> <span class="ow">and</span> <span class="n">userName</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">"."</span><span class="p">:</span>
        <span class="n">userName</span> <span class="o">=</span> <span class="s">"_"</span> <span class="o">+</span> <span class="n">userName</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="c"># filter the user name</span>
    <span class="n">filteredUserName</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">character</span> <span class="ow">in</span> <span class="n">userName</span><span class="p">:</span>
        <span class="c"># replace illegal characters with _</span>
        <span class="k">if</span> <span class="n">character</span> <span class="ow">in</span> <span class="n">illegalCharacters</span><span class="p">:</span>
            <span class="n">character</span> <span class="o">=</span> <span class="s">"_"</span>
        <span class="c"># add _ to all non-lower characters</span>
        <span class="k">elif</span> <span class="n">character</span> <span class="o">!=</span> <span class="n">character</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="n">character</span> <span class="o">+=</span> <span class="s">"_"</span>
        <span class="n">filteredUserName</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">character</span><span class="p">)</span>
    <span class="n">userName</span> <span class="o">=</span> <span class="s">""</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">filteredUserName</span><span class="p">)</span>
    <span class="c"># clip to 255</span>
    <span class="n">sliceLength</span> <span class="o">=</span> <span class="n">maxFileNameLength</span> <span class="o">-</span> <span class="n">prefixLength</span> <span class="o">-</span> <span class="n">suffixLength</span>
    <span class="n">userName</span> <span class="o">=</span> <span class="n">userName</span><span class="p">[:</span><span class="n">sliceLength</span><span class="p">]</span>
    <span class="c"># test for illegal files names</span>
    <span class="n">parts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">userName</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">"."</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">part</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">reservedFileNames</span><span class="p">:</span>
            <span class="n">part</span> <span class="o">=</span> <span class="s">"_"</span> <span class="o">+</span> <span class="n">part</span>
        <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">part</span><span class="p">)</span>
    <span class="n">userName</span> <span class="o">=</span> <span class="s">"."</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>
    <span class="c"># test for clash</span>
    <span class="n">fullName</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="n">userName</span> <span class="o">+</span> <span class="n">suffix</span>
    <span class="k">if</span> <span class="n">fullName</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">existing</span><span class="p">:</span>
        <span class="n">fullName</span> <span class="o">=</span> <span class="n">handleClash1</span><span class="p">(</span><span class="n">userName</span><span class="p">,</span> <span class="n">existing</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">suffix</span><span class="p">)</span>
    <span class="c"># finished</span>
    <span class="k">return</span> <span class="n">fullName</span>

<span class="k">def</span> <span class="nf">handleClash1</span><span class="p">(</span><span class="n">userName</span><span class="p">,</span> <span class="n">existing</span><span class="o">=</span><span class="p">[],</span> <span class="n">prefix</span><span class="o">=</span><span class="s">""</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s">""</span><span class="p">):</span>
    <span class="s">"""
    existing should be a case-insensitive list
    of all existing file names.

    &gt;&gt;&gt; prefix = ("0" * 5) + "."
    &gt;&gt;&gt; suffix = "." + ("0" * 10)
    &gt;&gt;&gt; existing = ["a" * 5]

    &gt;&gt;&gt; e = list(existing)
    &gt;&gt;&gt; handleClash1(userName="A" * 5, existing=e,
    ...     prefix=prefix, suffix=suffix)
    '00000.AAAAA000000000000001.0000000000'

    &gt;&gt;&gt; e = list(existing)
    &gt;&gt;&gt; e.append(prefix + "aaaaa" + "1".zfill(15) + suffix)
    &gt;&gt;&gt; handleClash1(userName="A" * 5, existing=e,
    ...     prefix=prefix, suffix=suffix)
    '00000.AAAAA000000000000002.0000000000'

    &gt;&gt;&gt; e = list(existing)
    &gt;&gt;&gt; e.append(prefix + "AAAAA" + "2".zfill(15) + suffix)
    &gt;&gt;&gt; handleClash1(userName="A" * 5, existing=e,
    ...     prefix=prefix, suffix=suffix)
    '00000.AAAAA000000000000001.0000000000'
    """</span>
    <span class="c"># if the prefix length + user name length + suffix length + 15 is at</span>
    <span class="c"># or past the maximum length, silce 15 characters off of the user name</span>
    <span class="n">prefixLength</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span>
    <span class="n">suffixLength</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">suffix</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">prefixLength</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">userName</span><span class="p">)</span> <span class="o">+</span> <span class="n">suffixLength</span> <span class="o">+</span> <span class="mi">15</span> <span class="o">&gt;</span> <span class="n">maxFileNameLength</span><span class="p">:</span>
        <span class="n">l</span> <span class="o">=</span> <span class="p">(</span><span class="n">prefixLength</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">userName</span><span class="p">)</span> <span class="o">+</span> <span class="n">suffixLength</span> <span class="o">+</span> <span class="mi">15</span><span class="p">)</span>
        <span class="n">sliceLength</span> <span class="o">=</span> <span class="n">maxFileNameLength</span> <span class="o">-</span> <span class="n">l</span>
        <span class="n">userName</span> <span class="o">=</span> <span class="n">userName</span><span class="p">[:</span><span class="n">sliceLength</span><span class="p">]</span>
    <span class="n">finalName</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="c"># try to add numbers to create a unique name</span>
    <span class="n">counter</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">while</span> <span class="n">finalName</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">userName</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">counter</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
        <span class="n">fullName</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="n">suffix</span>
        <span class="k">if</span> <span class="n">fullName</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">existing</span><span class="p">:</span>
            <span class="n">finalName</span> <span class="o">=</span> <span class="n">fullName</span>
            <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">counter</span> <span class="o">&gt;=</span> <span class="mi">999999999999999</span><span class="p">:</span>
            <span class="k">break</span>
    <span class="c"># if there is a clash, go to the next fallback</span>
    <span class="k">if</span> <span class="n">finalName</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">finalName</span> <span class="o">=</span> <span class="n">handleClash2</span><span class="p">(</span><span class="n">existing</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">suffix</span><span class="p">)</span>
    <span class="c"># finished</span>
    <span class="k">return</span> <span class="n">finalName</span>

<span class="k">def</span> <span class="nf">handleClash2</span><span class="p">(</span><span class="n">existing</span><span class="o">=</span><span class="p">[],</span> <span class="n">prefix</span><span class="o">=</span><span class="s">""</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s">""</span><span class="p">):</span>
    <span class="s">"""
    existing should be a case-insensitive list
    of all existing file names.

    &gt;&gt;&gt; prefix = ("0" * 5) + "."
    &gt;&gt;&gt; suffix = "." + ("0" * 10)
    &gt;&gt;&gt; existing = [prefix + str(i) + suffix for i in range(100)]

    &gt;&gt;&gt; e = list(existing)
    &gt;&gt;&gt; handleClash2(existing=e, prefix=prefix, suffix=suffix)
    '00000.100.0000000000'

    &gt;&gt;&gt; e = list(existing)
    &gt;&gt;&gt; e.remove(prefix + "1" + suffix)
    &gt;&gt;&gt; handleClash2(existing=e, prefix=prefix, suffix=suffix)
    '00000.1.0000000000'

    &gt;&gt;&gt; e = list(existing)
    &gt;&gt;&gt; e.remove(prefix + "2" + suffix)
    &gt;&gt;&gt; handleClash2(existing=e, prefix=prefix, suffix=suffix)
    '00000.2.0000000000'
    """</span>
    <span class="c"># calculate the longest possible string</span>
    <span class="n">maxLength</span> <span class="o">=</span> <span class="n">maxFileNameLength</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">suffix</span><span class="p">)</span>
    <span class="n">maxValue</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="s">"9"</span> <span class="o">*</span> <span class="n">maxLength</span><span class="p">)</span>
    <span class="c"># try to find a number</span>
    <span class="n">finalName</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">counter</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">while</span> <span class="n">finalName</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">fullName</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">counter</span><span class="p">)</span> <span class="o">+</span> <span class="n">suffix</span>
        <span class="k">if</span> <span class="n">fullName</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">existing</span><span class="p">:</span>
            <span class="n">finalName</span> <span class="o">=</span> <span class="n">fullName</span>
            <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">counter</span> <span class="o">&gt;=</span> <span class="n">maxValue</span><span class="p">:</span>
            <span class="k">break</span>
    <span class="c"># raise an error if nothing has been found</span>
    <span class="k">if</span> <span class="n">finalName</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">NameTranslationError</span><span class="p">(</span><span class="s">"No unique name could be found."</span><span class="p">)</span>
    <span class="c"># finished</span>
    <span class="k">return</span> <span class="n">finalName</span>
</code></pre>
</div>

<h3 id="identifiers">Identifiers</h3>

<p>Identifiers are optional attributes of several objects in the UFO. These identifiers are required to be unique within certain contexts as defined on a per object basis throughout this specification. Identifiers are specified as a string between one and 100 characters long. All characters must be in the printable ASCII range, 0x20 to 0x7E.</p>

<p>There is no standard identifier generation algorithm. Random strings, simple numbers, UUIDs, time stamps and more may be used. An example algorithm for generating identifiers that are random strings is detailed below.</p>

<h4 id="example-algorithm">Example Algorithm</h4>

<p>This algorithm is designed to generate a unique identifier that is a unique string consisting of 10 characters from 0-9, A-Z and a-z. This allows a glyph to contain 10<sup>62</sup> points that follow this identifier naming scheme.</p>

<ul>
  <li><em>possible characters</em> includes 0-9, A-Z and a-z.</li>
  <li><em>existing identifiers</em> is a list of all existing identifiers in the glyph.</li>
  <li><em>identifier</em> a 10 character long string of characters randomly selected from <em>possible characters</em>.</li>
  <li>If <em>identifier</em> is not in <em>existing identifiers</em>:</li>
  <li>
    <ul>
      <li>Stop.</li>
    </ul>
  </li>
  <li>If <em>identifier</em> is in <em>existing identifiers</em>:</li>
  <li>
    <ul>
      <li>Repeat this process until a unique identifier is found.</li>
    </ul>
  </li>
</ul>

<h4 id="example-implementation-1">Example implementation:</h4>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">random</span>

<span class="n">characters</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="s">"0123456789"</span><span class="p">)</span>
<span class="n">characters</span> <span class="o">+=</span> <span class="nb">list</span><span class="p">(</span><span class="s">"ABCDEFGHIJKLMNOPQRSTUVWXYZ"</span><span class="p">)</span>
<span class="n">characters</span> <span class="o">+=</span> <span class="nb">list</span><span class="p">(</span><span class="s">"abcdefghijklmnopqrstuvwxyz"</span><span class="p">)</span>
<span class="n">identifierLength</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">identifierRange</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">identifierLength</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">makeRandomIdentifier</span><span class="p">(</span><span class="n">existing</span><span class="p">,</span> <span class="n">recursionDepth</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">recursionDepth</span> <span class="o">&gt;=</span> <span class="mi">50</span><span class="p">:</span>
        <span class="k">raise</span> <span class="nb">NotImplementedError</span><span class="p">,</span>\
            <span class="s">"Failed 50 times in a row to create a unique id. Sorry."</span>
    <span class="n">identifier</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">identifierRange</span><span class="p">:</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">characters</span><span class="p">)</span>
        <span class="n">identifier</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
    <span class="n">identifier</span> <span class="o">=</span> <span class="s">""</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">identifier</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">identifier</span> <span class="ow">in</span> <span class="n">existing</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">makeRandomIdentifier</span><span class="p">(</span><span class="n">existing</span><span class="p">,</span> <span class="n">recursionDepth</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">identifier</span>

</code></pre>
</div>


      </div>
    </div>
    <footer class="site-footer">
</footer>

  </body>
</html>
