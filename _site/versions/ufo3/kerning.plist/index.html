<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <title>kerning.plist</title>
  <meta name="description" content="The Unified Font Object (UFO) is a cross-platform, cross-application, human readable, future proof format for storing font data.
">

  <link rel="stylesheet" href="/media/main.css">
  <link rel="canonical" href="http://unifiedfontobject.org/versions/ufo3/kerning.plist/">
</head>

  <body>
    <header class="site-header">
    <div id="logo"></div>
    <div id="navigation">
        <ul>
            
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
                    
                    <li><a  href="/">Overview</a></li>
                    
                
            
                
                    
                    <li><a  href="/team/">The UFO Team</a></li>
                    
                
            
                
                    
                    <li><a  href="/resources/">Resources</a></li>
                    
                
            
                
                    
                    <li><a  href="/roadmap/">Roadmap</a></li>
                    
                
            
                
                    
                    <li><a  href="/atguidelines/">Authoring Tool Guidelines</a></li>
                    
                
            
                
                    
                        <li class="navigationSectionTitle">Versions</li>
                    
                    <li><a  href="/versions/ufo1/">UFO 1</a></li>
                    
                        <ul class="navigationNested ">
                            
                                <li><a href="/versions/ufo1/metainfo.plist">metainfo.plist</a></li>
                            
                                <li><a href="/versions/ufo1/fontinfo.plist">fontinfo.plist</a></li>
                            
                                <li><a href="/versions/ufo1/groups.plist">groups.plist</a></li>
                            
                                <li><a href="/versions/ufo1/kerning.plist">kerning.plist</a></li>
                            
                                <li><a href="/versions/ufo1/lib.plist">lib.plist</a></li>
                            
                                <li><a href="/versions/ufo1/glyphs">glyphs</a></li>
                            
                                <li class="navigationNested1"><a href="/versions/ufo1/glyphs/contents.plist">contents.plist</a></li>
                            
                                <li class="navigationNested1"><a href="/versions/ufo1/glyphs/glif">glif</a></li>
                            
                        </ul>
                    
                
            
                
                    
                    <li><a  href="/versions/ufo2/">UFO 2</a></li>
                    
                        <ul class="navigationNested ">
                            
                                <li><a href="/versions/ufo2/metainfo.plist">metainfo.plist</a></li>
                            
                                <li><a href="/versions/ufo2/fontinfo.plist">fontinfo.plist</a></li>
                            
                                <li><a href="/versions/ufo2/groups.plist">groups.plist</a></li>
                            
                                <li><a href="/versions/ufo2/kerning.plist">kerning.plist</a></li>
                            
                                <li><a href="/versions/ufo2/features.fea">features.fea</a></li>
                            
                                <li><a href="/versions/ufo2/lib.plist">lib.plist</a></li>
                            
                                <li><a href="/versions/ufo2/glyphs">glyphs</a></li>
                            
                                <li class="navigationNested1"><a href="/versions/ufo2/glyphs/contents.plist">contents.plist</a></li>
                            
                                <li class="navigationNested1"><a href="/versions/ufo2/glyphs/GLIF">GLIF</a></li>
                            
                        </ul>
                    
                
            
                
                    
                    <li><a  href="/versions/ufo3/">UFO 3</a></li>
                    
                        <ul class="navigationNested  active">
                            
                                <li><a href="/versions/ufo3/metainfo.plist">metainfo.plist</a></li>
                            
                                <li><a href="/versions/ufo3/fontinfo.plist">fontinfo.plist</a></li>
                            
                                <li><a href="/versions/ufo3/groups.plist">groups.plist</a></li>
                            
                                <li><a href="/versions/ufo3/kerning.plist">kerning.plist</a></li>
                            
                                <li><a href="/versions/ufo3/features.fea">features.fea</a></li>
                            
                                <li><a href="/versions/ufo3/lib.plist">lib.plist</a></li>
                            
                                <li><a href="/versions/ufo3/layercontents.plist">layercontents.plist</a></li>
                            
                                <li><a href="/versions/ufo3/glyphs">glyphs</a></li>
                            
                                <li class="navigationNested1"><a href="/versions/ufo3/glyphs/contents.plist">contents.plist</a></li>
                            
                                <li class="navigationNested1"><a href="/versions/ufo3/glyphs/layerinfo.plist">layerinfo.plist</a></li>
                            
                                <li class="navigationNested1"><a href="/versions/ufo3/glyphs/GLIF">GLIF</a></li>
                            
                                <li><a href="/versions/ufo3/images">images</a></li>
                            
                                <li><a href="/versions/ufo3/data">data</a></li>
                            
                                <li><a href="/versions/ufo3/conventions">conventions</a></li>
                            
                        </ul>
                    
                
            
        </ul>
    </div>
</header>

    <div id="content">
      <div class="section">
        
          <h1>kerning.plist</h1>
        
        <table>
  <tbody>
    <tr>
      <td><strong>File Format</strong></td>
      <td><a href="http://www.apple.com/DTDs/PropertyList-1.0.dtd">XML Property List</a></td>
    </tr>
  </tbody>
</table>

<p>This file contains horizontal kerning pairs for the font. This file is optional. If it is not defined in the UFO, there is no horizontal kerning data.</p>

<h2 id="specification">Specification</h2>

<p>The property list data consists of a dictionary at the top level. Keys are <em>first</em> member names and values are dictionaries. These dictionaries contain <em>second</em> member names as keys and kerning values, either integer or float, as the values.</p>

<p>The kerning pair members are glyph names or group names. Group names used as the first member of a kerning pair must begin with the kerning group prefix defined in the <a href="groups.plist">groups.plist specification</a>. Group names used as the second member of a kerning pair must begin with the kerning group prefix defined in the <a href="groups.plist">groups.plist specification</a>. Glyphs or groups in the pairs are not required to be in the font.</p>

<p>Kerning pairs that are not defined in kerning.plist implicitly have a value of “no kerning” or zero. Therefore any kerning pair that has a value of zero, unless it is a necessary value of an <a href="#kerning-pair-exceptions">exception</a>, should not be stored in kerning.plist.</p>

<h3 id="writing-direction">Writing Direction</h3>

<p>The kerning data is writing direction neutral. For text written left-to-right, the left-most glyph is the key in the top level dictionary. For text written right-to-left, the right-most glyph is the key in the top level dictionary. For example, given the pair <em>LG</em>, written left-to-right, the <em>L</em> is the key in the top dictionary and the <em>G</em> is the sub-dictionary. Given the pair <em>GL</em>, written right-to-left, the <em>G</em> is the key in the top dictionary and the <em>L</em> is the key in the sub-dictionary.</p>

<h3 id="kerning-pair-types">Kerning Pair Types</h3>

<p>Kerning pairs may reference groups. This is done by using a <a href="groups.html">group’s name</a> as a member of a kerning pair. These group members allow the kerning data to represent vast amounts of kerning with relatively few pairs. A pair member that contains a group implies that all members of the group are kerned with the other member of the pair with the same value (unless an exception is defined, see below). For example, a font has this group:</p>

<table>
  <thead>
    <tr>
      <th>name</th>
      <th>members</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>public.kern1.O</td>
      <td>O, D, Q</td>
    </tr>
  </tbody>
</table>

<p>The font’s kerning contains a pair referencing this group:</p>

<table>
  <thead>
    <tr>
      <th>Side 1</th>
      <th>Side 2</th>
      <th>Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>public.kern1.O</td>
      <td>A</td>
      <td>-50</td>
    </tr>
  </tbody>
</table>

<p>This implies that the pair values for the specific glyphs combinations are as follows:</p>

<table>
  <thead>
    <tr>
      <th>Side 1</th>
      <th>Side 2</th>
      <th>Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>O</td>
      <td>A</td>
      <td>-50</td>
    </tr>
    <tr>
      <td>O</td>
      <td>A</td>
      <td>-50</td>
    </tr>
    <tr>
      <td>D</td>
      <td>A</td>
      <td>-50</td>
    </tr>
  </tbody>
</table>

<p>The various combinations of glyphs and groups allow for three types of kerning pairs:</p>

<ol>
  <li>Group combinations: group + group. For example, public.kern1.O + public.kern2.E.</li>
  <li>Glyph and group combinations: glyph + group and group + glyph. For example, A + public.kern2.E and public.kern1.O + A.</li>
  <li>Glyph combinations: glyph + glyph. For example, A + X.</li>
</ol>

<h4 id="exceptions">Exceptions</h4>

<p>The kerning data may contain <em>exceptions</em> to group pairs. The kerning pair types are organized in three levels:</p>

<p>Level 1: Group combinations.<br />
Level 2: Glyph and group combinations.<br />
Level 3: Glyph combinations.</p>

<p>Exception pairs may occur at the second and third levels. Second level pairs may be exceptions to first level pairs. Third level pairs may be exceptions to first and second level pairs.</p>

<p>For example, a font has these two groups:</p>

<table>
  <thead>
    <tr>
      <th>name</th>
      <th>members</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>public.kern1.O</td>
      <td>O, D, Q</td>
    </tr>
    <tr>
      <td>public.kern2.E</td>
      <td>E, F</td>
    </tr>
  </tbody>
</table>

<p>The font’s kerning contains a first level pair that references these two groups:</p>

<table>
  <thead>
    <tr>
      <th>Side 1</th>
      <th>Side 2</th>
      <th>Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>public.kern1.O</td>
      <td>public.kern2.E</td>
      <td>-100</td>
    </tr>
  </tbody>
</table>

<p>The font’s kerning contains a second level pair that forms an exception to the first level pair:</p>

<table>
  <thead>
    <tr>
      <th>Side 1</th>
      <th>Side 2</th>
      <th>Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>public.kern1.O</td>
      <td>F</td>
      <td>-200</td>
    </tr>
  </tbody>
</table>

<p>The font’s kerning contains a third level pair that is an exception to both the first and second level pairs:</p>

<table>
  <thead>
    <tr>
      <th>Side 1</th>
      <th>Side 2</th>
      <th>Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>D</td>
      <td>F</td>
      <td>-300</td>
    </tr>
  </tbody>
</table>

<p>This implies that the pair values for the specific glyphs combinations are as follows:</p>

<table>
  <thead>
    <tr>
      <th>Side 1</th>
      <th>Side 2</th>
      <th>Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>O</td>
      <td>E</td>
      <td>-100</td>
    </tr>
    <tr>
      <td>O</td>
      <td>F</td>
      <td>-200</td>
    </tr>
    <tr>
      <td>D</td>
      <td>E</td>
      <td>-100</td>
    </tr>
    <tr>
      <td>D</td>
      <td>F</td>
      <td>-300</td>
    </tr>
    <tr>
      <td>Q</td>
      <td>E</td>
      <td>-100</td>
    </tr>
    <tr>
      <td>Q</td>
      <td>F</td>
      <td>-200</td>
    </tr>
  </tbody>
</table>

<h5 id="exception-caveat">Exception Caveat</h5>

<p>Exceptions are very powerful, but there is one rule that must be followed. <strong>There must not be contradictions within a level.</strong> For example, given the same public.kern1.O and public.kern2.E group as above, a font contains the following kerning pairs:</p>

<table>
  <thead>
    <tr>
      <th>Side 1</th>
      <th>Side 2</th>
      <th>Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>public.kern1.O</td>
      <td>public.kern2.E</td>
      <td>-100</td>
    </tr>
    <tr>
      <td>public.kern1.O</td>
      <td>F</td>
      <td>-200</td>
    </tr>
    <tr>
      <td>Q</td>
      <td>public.kern2.E</td>
      <td>-250</td>
    </tr>
    <tr>
      <td>D</td>
      <td>F</td>
      <td>-300</td>
    </tr>
  </tbody>
</table>

<p>This implies that the pair values for the specific glyphs combinations are as follows:</p>

<table>
  <thead>
    <tr>
      <th>Side 1</th>
      <th>Side 2</th>
      <th>Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>O</td>
      <td>E</td>
      <td>-100</td>
    </tr>
    <tr>
      <td>O</td>
      <td>F</td>
      <td>-200</td>
    </tr>
    <tr>
      <td>D</td>
      <td>E</td>
      <td>-100</td>
    </tr>
    <tr>
      <td>D</td>
      <td>F</td>
      <td>-300</td>
    </tr>
    <tr>
      <td>Q</td>
      <td>E</td>
      <td>-250</td>
    </tr>
    <tr>
      <td>Q</td>
      <td>F</td>
      <td><strong>-200 or -250</strong></td>
    </tr>
  </tbody>
</table>

<p>The two second level pairs, public.kern1.O + F and Q + public.kern2.E define two possible values for the pair Q + F. This is an unresolvable ambiguity. These types of contradictions must be avoided.</p>

<h4 id="kerning-value-lookup-algorithm">Kerning Value Lookup Algorithm</h4>

<p>The task of finding a value for a particular glyph + glyph combination is relatively easy. The following algorithm demonstrates a way that it can be done for a given pair.</p>

<p>If the pair <em>first glyph + second glyph</em> is in the kerning data:<br />
-   The value for <em>first glyph + second glyph</em> is the value.<br />
-   Stop.</p>

<p>If the second glyph is in a kerning group:<br />
<em>second group</em> is the name of the kerning group containing the second glyph.<br />
If the pair <em>first glyph + second group</em> is in the kerning data:<br />
-   The value for <em>first glyph + second group</em> is the value.<br />
-   Stop.</p>

<p>If the first glyph is in a kerning group:<br />
<em>first group</em> is the name of the kerning group containing the first glyph.<br />
If the pair <em>first group + second glyph</em> is in the kerning data:<br />
-   The value for <em>first first + second glyph</em> is the value.<br />
-   Stop.</p>

<p>If the first glyph is in a kerning group and the second glyph is in a kerning group:<br />
<em>first group</em> is the name of the kerning group containing the first glyph.<br />
<em>second group</em> is the name of the kerning group containing the second glyph.<br />
If the pair <em>first group + second group</em> is in the kerning data:<br />
-   The value for <em>first group + second group</em> is the value.<br />
-   Stop.</p>

<p>The value is zero.</p>

<h5 id="sample-implementation">Sample implementation</h5>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="nf">lookupKerningValue</span><span class="p">(</span><span class="n">pair</span><span class="p">,</span> <span class="n">kerning</span><span class="p">,</span> <span class="n">groups</span><span class="p">,</span> <span class="n">fallback</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="s">"""
    Note: This expects kerning to be a flat dictionary
    of kerning pairs, not the nested structure used
    in kerning.plist.

    &gt;&gt;&gt; groups = {
    ...     "public.kern1.O" : ["O", "D", "Q"],
    ...     "public.kern2.E" : ["E", "F"]
    ... }
    &gt;&gt;&gt; kerning = {
    ...     ("public.kern1.O", "public.kern2.E") : -100,
    ...     ("public.kern1.O", "F") : -200,
    ...     ("D", "F") : -300
    ... }
    &gt;&gt;&gt; lookupKerningValue(("D", "F"), kerning, groups)
    -300
    &gt;&gt;&gt; lookupKerningValue(("O", "F"), kerning, groups)
    -200
    &gt;&gt;&gt; lookupKerningValue(("O", "E"), kerning, groups)
    -100
    &gt;&gt;&gt; lookupKerningValue(("O", "O"), kerning, groups)
    0
    &gt;&gt;&gt; lookupKerningValue(("E", "E"), kerning, groups)
    0
    &gt;&gt;&gt; lookupKerningValue(("E", "O"), kerning, groups)
    0
    &gt;&gt;&gt; lookupKerningValue(("X", "X"), kerning, groups)
    0
    &gt;&gt;&gt; lookupKerningValue(("public.kern1.O", "public.kern2.E"),
    ...     kerning, groups)
    -100
    &gt;&gt;&gt; lookupKerningValue(("public.kern1.O", "F"), kerning, groups)
    -200
    &gt;&gt;&gt; lookupKerningValue(("O", "public.kern2.E"), kerning, groups)
    -100
    &gt;&gt;&gt; lookupKerningValue(("public.kern1.X", "public.kern2.X"), kerning, groups)
    0
    """</span>
    <span class="c"># quickly check to see if the pair is in the kerning dictionary</span>
    <span class="k">if</span> <span class="n">pair</span> <span class="ow">in</span> <span class="n">kerning</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">kerning</span><span class="p">[</span><span class="n">pair</span><span class="p">]</span>
    <span class="c"># get group names and make sure first and second are glyph names</span>
    <span class="n">first</span><span class="p">,</span> <span class="n">second</span> <span class="o">=</span> <span class="n">pair</span>
    <span class="n">firstGroup</span> <span class="o">=</span> <span class="n">secondGroup</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="n">first</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">"public.kern1."</span><span class="p">):</span>
        <span class="n">firstGroup</span> <span class="o">=</span> <span class="n">first</span>
        <span class="n">first</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">group</span><span class="p">,</span> <span class="n">groupMembers</span> <span class="ow">in</span> <span class="n">groups</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">group</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">"public.kern1."</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">first</span> <span class="ow">in</span> <span class="n">groupMembers</span><span class="p">:</span>
                    <span class="n">firstGroup</span> <span class="o">=</span> <span class="n">group</span>
                    <span class="k">break</span>
    <span class="k">if</span> <span class="n">second</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">"public.kern2."</span><span class="p">):</span>
        <span class="n">secondGroup</span> <span class="o">=</span> <span class="n">second</span>
        <span class="n">second</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">group</span><span class="p">,</span> <span class="n">groupMembers</span> <span class="ow">in</span> <span class="n">groups</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">group</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">"public.kern2."</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">second</span> <span class="ow">in</span> <span class="n">groupMembers</span><span class="p">:</span>
                    <span class="n">secondGroup</span> <span class="o">=</span> <span class="n">group</span>
                    <span class="k">break</span>
    <span class="c"># make an ordered list of pairs to look up</span>
    <span class="n">pairs</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="n">second</span><span class="p">),</span>
        <span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="n">secondGroup</span><span class="p">),</span>
        <span class="p">(</span><span class="n">firstGroup</span><span class="p">,</span> <span class="n">second</span><span class="p">),</span>
        <span class="p">(</span><span class="n">firstGroup</span><span class="p">,</span> <span class="n">secondGroup</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="c"># look up the pairs and return any matches</span>
    <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="n">pairs</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">pair</span> <span class="ow">in</span> <span class="n">kerning</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">kerning</span><span class="p">[</span><span class="n">pair</span><span class="p">]</span>
    <span class="c"># use the fallback value</span>
    <span class="k">return</span> <span class="n">fallback</span>
</code></pre>
</div>

<h3 id="example">Example</h3>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="cp">&lt;!DOCTYPE plist PUBLIC "-//Apple Computer//DTD PLIST 1.0//EN"
"http://www.apple.com/DTDs/PropertyList-1.0.dtd"&gt;</span>
<span class="nt">&lt;plist</span> <span class="na">version=</span><span class="s">"1.0"</span><span class="nt">&gt;</span>
<span class="nt">&lt;dict&gt;</span>
  <span class="nt">&lt;key&gt;</span>public.kern1.BGroup<span class="nt">&lt;/key&gt;</span>
  <span class="nt">&lt;dict&gt;</span>
    <span class="nt">&lt;key&gt;</span>public.kern2.CGroup<span class="nt">&lt;/key&gt;</span>
    <span class="nt">&lt;integer&gt;</span>7<span class="nt">&lt;/integer&gt;</span>
    <span class="nt">&lt;key&gt;</span>public.kern2.DGroup<span class="nt">&lt;/key&gt;</span>
    <span class="nt">&lt;integer&gt;</span>8<span class="nt">&lt;/integer&gt;</span>
    <span class="nt">&lt;key&gt;</span>A<span class="nt">&lt;/key&gt;</span>
    <span class="nt">&lt;integer&gt;</span>5<span class="nt">&lt;/integer&gt;</span>
    <span class="nt">&lt;key&gt;</span>B<span class="nt">&lt;/key&gt;</span>
    <span class="nt">&lt;integer&gt;</span>6<span class="nt">&lt;/integer&gt;</span>
  <span class="nt">&lt;/dict&gt;</span>
  <span class="nt">&lt;key&gt;</span>public.kern1.CGroup<span class="nt">&lt;/key&gt;</span>
  <span class="nt">&lt;dict&gt;</span>
    <span class="nt">&lt;key&gt;</span>public.kern2.CGroup<span class="nt">&lt;/key&gt;</span>
    <span class="nt">&lt;integer&gt;</span>11<span class="nt">&lt;/integer&gt;</span>
    <span class="nt">&lt;key&gt;</span>public.kern2.DGroup<span class="nt">&lt;/key&gt;</span>
    <span class="nt">&lt;integer&gt;</span>12<span class="nt">&lt;/integer&gt;</span>
    <span class="nt">&lt;key&gt;</span>A<span class="nt">&lt;/key&gt;</span>
    <span class="nt">&lt;integer&gt;</span>9<span class="nt">&lt;/integer&gt;</span>
    <span class="nt">&lt;key&gt;</span>B<span class="nt">&lt;/key&gt;</span>
    <span class="nt">&lt;integer&gt;</span>10<span class="nt">&lt;/integer&gt;</span>
  <span class="nt">&lt;/dict&gt;</span>
  <span class="nt">&lt;key&gt;</span>A<span class="nt">&lt;/key&gt;</span>
  <span class="nt">&lt;dict&gt;</span>
    <span class="nt">&lt;key&gt;</span>public.kern2.CGroup<span class="nt">&lt;/key&gt;</span>
    <span class="nt">&lt;integer&gt;</span>3<span class="nt">&lt;/integer&gt;</span>
    <span class="nt">&lt;key&gt;</span>public.kern2.DGroup<span class="nt">&lt;/key&gt;</span>
    <span class="nt">&lt;integer&gt;</span>4<span class="nt">&lt;/integer&gt;</span>
    <span class="nt">&lt;key&gt;</span>A<span class="nt">&lt;/key&gt;</span>
    <span class="nt">&lt;integer&gt;</span>1<span class="nt">&lt;/integer&gt;</span>
    <span class="nt">&lt;key&gt;</span>B<span class="nt">&lt;/key&gt;</span>
    <span class="nt">&lt;integer&gt;</span>2<span class="nt">&lt;/integer&gt;</span>
  <span class="nt">&lt;/dict&gt;</span>
<span class="nt">&lt;/dict&gt;</span>
<span class="nt">&lt;/plist&gt;</span>

</code></pre>
</div>

<h1 id="converting-to-ufo-3-formatted-kerning">Converting to UFO 3 formatted kerning</h1>

<p>In UFO 1 and UFO 2, the implication was that if a member of a kerning pair had the same name as a group and a glyph, that member was the group. In UFO 3, all kerning groups are identified through the use of the standard group prefixes defined in the <a href="groups.html">groups.plist specification</a>. An algorithm for converting UFO 1 and UFO 2 group kerning is detailed below.</p>

<h3 id="conversion-algorithm">Conversion algorithm</h3>

<p>Note: this algorithm, and its sample implementation, does not check the compliance of the kerning groups with the requirements defined in the groups.plist specification.</p>

<ul>
  <li>Make a list of groups referenced on the first side of kerning pairs.</li>
  <li>For each of these groups:</li>
  <li>
    <ul>
      <li><em>original group name</em> is the original group name.</li>
      <li>If <em>original group name</em> does not begin with <em>public.kern1.</em>:</li>
      <li>
        <ul>
          <li><em>new group name</em> is <em>public.kern1</em> plus <em>original group name</em>.</li>
          <li>If <em>new group name</em> is already in the groups:</li>
          <li>
            <ul>
              <li>Beginning with 1, add a number to the end of <em>new group name</em>. Repeat until a unique name is found.</li>
            </ul>
          </li>
        </ul>
      </li>
      <li>Copy the contents of the group and store them in groups.plist under <em>new group name</em>.</li>
      <li>Copy and remove the dictionary from kerning.plist that is stored under the key <em>original group name</em>.</li>
      <li>Add <em>new group name</em> as a key to kerning.plist with the copied dictionary as the value.</li>
    </ul>
  </li>
  <li>Make a list of groups referenced on the second side of kerning pairs.</li>
  <li>For each of these groups:</li>
  <li>
    <ul>
      <li><em>original group name</em> is the original group name.</li>
      <li>If <em>original group name</em> does not begin with <em>public.kern2.</em> as defined in fontinfo.plist:</li>
      <li>
        <ul>
          <li><em>new group name</em> is <em>public.kern2.</em> plus <em>original group name</em>.</li>
          <li>If <em>new group name</em> is already in the groups:</li>
          <li>
            <ul>
              <li>Beginning with 1, add a number to the end of <em>new group name</em>. Repeat until a unique name is found.</li>
            </ul>
          </li>
        </ul>
      </li>
      <li>Copy the contents of the group and store them in groups.plist under <em>new group name</em>.</li>
      <li>For each first glyph and dictionary in kerning.plist:</li>
      <li>
        <ul>
          <li>If <em>original group name</em> is a key in the dictionary:</li>
          <li>
            <ul>
              <li>Copy the <em>value</em> stored under <em>original group name</em>.</li>
              <li>Remove <em>original group name</em> from the dictionary.</li>
              <li>Add <em>new group name</em> as a key in the dictionary with <em>value</em> as the value.</li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h3 id="sample-conversion-implementation">Sample conversion implementation</h3>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="nf">convertUFO1OrUFO2KerningToUFO3Kerning</span><span class="p">(</span><span class="n">kerning</span><span class="p">,</span> <span class="n">groups</span><span class="p">):</span>
    <span class="c"># Make lists of groups referenced in kerning pairs.</span>
    <span class="n">firstReferencedGroups</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="n">secondReferencedGroups</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">first</span><span class="p">,</span> <span class="n">seconds</span> <span class="ow">in</span> <span class="n">kerning</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">first</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">first</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">"public.kern1."</span><span class="p">):</span>
                <span class="n">firstReferencedGroups</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">first</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">second</span> <span class="ow">in</span> <span class="n">seconds</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">second</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">second</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">"public.kern2."</span><span class="p">):</span>
                    <span class="n">secondReferencedGroups</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">second</span><span class="p">)</span>
    <span class="c"># Create new names for these groups.</span>
    <span class="n">firstRenamedGroups</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">first</span> <span class="ow">in</span> <span class="n">firstReferencedGroups</span><span class="p">:</span>
        <span class="c"># Make a list of existing group names.</span>
        <span class="n">existingGroupNames</span> <span class="o">=</span> <span class="n">groups</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="o">+</span> <span class="n">firstRenamedGroups</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="c"># Add the prefix to the name.</span>
        <span class="n">newName</span> <span class="o">=</span> <span class="s">"public.kern1."</span> <span class="o">+</span> <span class="n">first</span>
        <span class="c"># Make a unique group name.</span>
        <span class="n">newName</span> <span class="o">=</span> <span class="n">makeUniqueGroupName</span><span class="p">(</span><span class="n">newName</span><span class="p">,</span> <span class="n">existingGroupNames</span><span class="p">)</span>
        <span class="c"># Store for use later.</span>
        <span class="n">firstRenamedGroups</span><span class="p">[</span><span class="n">first</span><span class="p">]</span> <span class="o">=</span> <span class="n">newName</span>
    <span class="n">secondRenamedGroups</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">second</span> <span class="ow">in</span> <span class="n">secondReferencedGroups</span><span class="p">:</span>
        <span class="c"># Make a list of existing group names.</span>
        <span class="n">existingGroupNames</span> <span class="o">=</span> <span class="n">groups</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="o">+</span> <span class="n">secondRenamedGroups</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="c"># Add the prefix to the name.</span>
        <span class="n">newName</span> <span class="o">=</span> <span class="s">"public.kern2."</span> <span class="o">+</span> <span class="n">second</span>
        <span class="c"># Make a unique group name.</span>
        <span class="n">newName</span> <span class="o">=</span> <span class="n">makeUniqueGroupName</span><span class="p">(</span><span class="n">newName</span><span class="p">,</span> <span class="n">existingGroupNames</span><span class="p">)</span>
        <span class="c"># Store for use later.</span>
        <span class="n">secondRenamedGroups</span><span class="p">[</span><span class="n">second</span><span class="p">]</span> <span class="o">=</span> <span class="n">newName</span>
    <span class="c"># Populate the new group names into the kerning dictionary as needed.</span>
    <span class="n">newKerning</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">first</span><span class="p">,</span> <span class="n">seconds</span> <span class="ow">in</span> <span class="n">kerning</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">first</span> <span class="o">=</span> <span class="n">firstRenamedGroups</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="n">first</span><span class="p">)</span>
        <span class="n">newSeconds</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">second</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">seconds</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">second</span> <span class="o">=</span> <span class="n">secondRenamedGroups</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">second</span><span class="p">,</span> <span class="n">second</span><span class="p">)</span>
            <span class="n">newSeconds</span><span class="p">[</span><span class="n">second</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="n">newKerning</span><span class="p">[</span><span class="n">first</span><span class="p">]</span> <span class="o">=</span> <span class="n">newSeconds</span>
    <span class="c"># Make copies of the referenced groups and store them</span>
    <span class="c"># under the new names in the overall groups dictionary.</span>
    <span class="n">allRenamedGroups</span> <span class="o">=</span> <span class="n">firstRenamedGroups</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
    <span class="n">allRenamedGroups</span> <span class="o">+=</span> <span class="n">secondRenamedGroups</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">oldName</span><span class="p">,</span> <span class="n">newName</span> <span class="ow">in</span> <span class="n">allRenamedGroups</span><span class="p">:</span>
        <span class="n">group</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">groups</span><span class="p">[</span><span class="n">oldName</span><span class="p">])</span>
        <span class="n">groups</span><span class="p">[</span><span class="n">newName</span><span class="p">]</span> <span class="o">=</span> <span class="n">group</span>
    <span class="c"># Return the kerning and the groups.</span>
    <span class="k">return</span> <span class="n">newKerning</span><span class="p">,</span> <span class="n">groups</span>

<span class="k">def</span> <span class="nf">makeUniqueGroupName</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">groupNames</span><span class="p">,</span> <span class="n">counter</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="c"># Add a number to the name if the counter is higher than zero.</span>
    <span class="n">newName</span> <span class="o">=</span> <span class="n">name</span>
    <span class="k">if</span> <span class="n">counter</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">newName</span> <span class="o">=</span> <span class="s">"</span><span class="si">%</span><span class="s">s</span><span class="si">%</span><span class="s">d"</span> <span class="o">%</span> <span class="p">(</span><span class="n">newName</span><span class="p">,</span> <span class="n">counter</span><span class="p">)</span>
    <span class="c"># If the new name is in the existing group names, recurse.</span>
    <span class="k">if</span> <span class="n">newName</span> <span class="ow">in</span> <span class="n">groupNames</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">makeUniqueGroupName</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">groupNames</span><span class="p">,</span> <span class="n">counter</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="c"># Otherwise send back the new name.</span>
    <span class="k">return</span> <span class="n">newName</span>

<span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
    <span class="s">"""
    &gt;&gt;&gt; testKerning = {
    ...     "A" : {
    ...         "A" : 1,
    ...         "B" : 2,
    ...         "CGroup" : 3,
    ...         "DGroup" : 4
    ...     },
    ...     "BGroup" : {
    ...         "A" : 5,
    ...         "B" : 6,
    ...         "CGroup" : 7,
    ...         "DGroup" : 8
    ...     },
    ...     "CGroup" : {
    ...         "A" : 9,
    ...         "B" : 10,
    ...         "CGroup" : 11,
    ...         "DGroup" : 12
    ...     },
    ... }
    &gt;&gt;&gt; testGroups = {
    ...     "BGroup" : ["B"],
    ...     "CGroup" : ["C"],
    ...     "DGroup" : ["D"],
    ... }
    &gt;&gt;&gt; kerning, groups = convertUFO1OrUFO2KerningToUFO3Kerning(
    ...     testKerning, testGroups)
    &gt;&gt;&gt; expected = {
    ...     "A" : {
    ...         "A": 1,
    ...         "B": 2,
    ...         "public.kern2.CGroup": 3,
    ...         "public.kern2.DGroup": 4
    ...     },
    ...     "public.kern1.BGroup": {
    ...         "A": 5,
    ...         "B": 6,
    ...         "public.kern2.CGroup": 7,
    ...         "public.kern2.DGroup": 8
    ...     },
    ...     "public.kern1.CGroup": {
    ...         "A": 9,
    ...         "B": 10,
    ...         "public.kern2.CGroup": 11,
    ...         "public.kern2.DGroup": 12
    ...     }
    ... }
    &gt;&gt;&gt; kerning == expected
    True
    &gt;&gt;&gt; expected = {
    ...     "BGroup": ["B"],
    ...     "CGroup": ["C"],
    ...     "DGroup": ["D"],
    ...     "public.kern1.BGroup": ["B"],
    ...     "public.kern1.CGroup": ["C"],
    ...     "public.kern2.CGroup": ["C"],
    ...     "public.kern2.DGroup": ["D"],
    ... }
    &gt;&gt;&gt; groups == expected
    True
    """</span>

</code></pre>
</div>


      </div>
    </div>
    <footer class="site-footer">
</footer>

  </body>
</html>
